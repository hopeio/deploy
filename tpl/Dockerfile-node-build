# Builder Image
FROM node:16.16-alpine3.16 AS compile

WORKDIR /work

ADD ./* /work

RUN npm install

RUN npm run rollup-${app}

FROM node:16.16-alpine3.16

#修改容器时区
ENV TZ=Asia/Shanghai LANG=C.UTF-8
COPY ./build/k8s/app/tz/localtime /etc/localtime
COPY ./build/k8s/app/tz/timezone /etc/timezone
RUN mkdir -p /usr/share/zoneinfo/Asia && ln -s /etc/localtime /usr/share/zoneinfo/Asia/Shanghai

WORKDIR /app

COPY --from=compile /work/dist/${output} /app

RUN npm install nodemon -g

CMD ["nodemon", "${cmd}"]